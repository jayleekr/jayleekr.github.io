---
// Ultra-minimal theme toggle - overreacted.io style
---

<button id="theme-toggle" aria-label="Toggle theme" title="Toggle dark mode">
  ðŸŒ™
</button>

<script>
  function initThemeToggle() {
    const toggle = document.getElementById('theme-toggle');
    const html = document.documentElement;

    if (!toggle) return;

    // Get stored theme or default to dark
    function getTheme() {
      if (typeof localStorage !== 'undefined') {
        const stored = localStorage.getItem('theme');
        if (stored) return stored;
      }
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    // Set theme
    function setTheme(theme: string) {
      if (theme === 'dark') {
        html.classList.add('dark');
      } else {
        html.classList.remove('dark');
      }
      if (typeof localStorage !== 'undefined') {
        localStorage.setItem('theme', theme);
      }
      // Update button emoji
      if (toggle) {
        toggle.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        toggle.setAttribute('aria-label', `Switch to ${theme === 'dark' ? 'light' : 'dark'} mode`);
      }
    }

    // Initialize theme
    const currentTheme = getTheme();
    setTheme(currentTheme);

    // Remove existing listener if any (prevent duplicates)
    const newToggle = toggle.cloneNode(true) as HTMLElement;
    toggle.parentNode?.replaceChild(newToggle, toggle);

    // Toggle on click
    newToggle.addEventListener('click', () => {
      const current = html.classList.contains('dark') ? 'dark' : 'light';
      const next = current === 'dark' ? 'light' : 'dark';
      setTheme(next);
    });

    // Listen for system theme changes
    if (typeof window !== 'undefined') {
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!localStorage.getItem('theme')) {
          setTheme(e.matches ? 'dark' : 'light');
        }
      });
    }
  }

  // Run on initial load
  initThemeToggle();

  // Re-run after ViewTransitions navigation
  document.addEventListener('astro:page-load', initThemeToggle);
</script>

<style>
  button {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.5rem;
    line-height: 1;
    transition: opacity 0.2s ease;
  }

  button:hover {
    opacity: 0.7;
  }

  button:focus {
    outline: 2px solid var(--link);
    outline-offset: 2px;
  }
</style>
